#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include "myFunc.h"

int main(int argc, char** argv) {
    char PID = argv[0];
    int fifoInOpen = open("FIFO_IN", O_RDWR);
    if (fifoInOpen == -1) {
        printf("Error during the opening of the FIFO IN, end of task.");
        exit(-1);
    }
    int fifoInWrite = (fifoInOpen, PID, sizeof(char));
    if (fifoInWrite == -1) {
        printf("Error during the writing in FIFO IN, end of the task.");
        exit(-2);
    }
    close("FIFO_IN");
    char* messageAtis;
    char* fifoPilName = concatenation(PID);
    int fifoPilote = mkfifo(fifoPilName, 0666);
    if (fifoPilote == -1) {
        printf("Error during the creation of the FIFO Pilote, end of the task");
        exit(-4);
    }
    int fifoPilOpen = open(fifoPilName, O_RDWR);
    if (fifoPilOpen == -1) {
        printf("Error during the opening of the FIFO PIL, end of the task.");
        exit(-3);
    }
    int fifoPilRead = read(fifoPilOpen, &messageAtis, sizeof(messageAtis));
    while (fifoPilRead == -1) {
        int fifoPilWrite = write(fifoPilOpen, "KO", sizeof(char[2]));
        if (fifoPilWrite == -1) {
            printf("Error during the writing of the answer, end of the task.");
            exit(-4);
        }
        Sleep(2);
        fifoPilRead = read(fifoPilOpen, &messageAtis, sizeof(messageAtis));
    }
    fifoPilWrite = write(fifoPilOpen, "OK", sizeof(char[2]));
        if (fifoPilWrite == -1) {
            printf("Error during the writing of the answer, end of the task.");
            exit(-5);
        }
    close(fifoPilOpen);
    return 0;












}
